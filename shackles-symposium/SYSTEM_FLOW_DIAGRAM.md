# Participant ID System - Visual Flow Diagram

## ğŸ”„ Complete Process Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PAYMENT VERIFICATION FLOW                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1ï¸âƒ£  USER REGISTRATION
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ User Signs Upâ”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â†’ Chooses registrationType:
           â”‚   â€¢ 'both'     â†’ SHGN prefix
           â”‚   â€¢ 'general'  â†’ SHEN prefix  
           â”‚   â€¢ 'workshop' â†’ SHWK prefix
           â”‚
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Uploads Payment  â”‚
    â”‚   Screenshot     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
    paymentStatus: 'pending'


2ï¸âƒ£  ADMIN DASHBOARD
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Admin Opens        â”‚
    â”‚ Payment Dashboard  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Clicks "Verify"    â”‚
    â”‚ on pending payment â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Adds verification  â”‚
    â”‚   notes (optional) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Clicks "Confirm"   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
    PUT /api/v1/admin/payments/:userId/verify


3ï¸âƒ£  BACKEND PROCESSING (Automatic)
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ verifyPayment() Controller                          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”œâ”€â”€â†’ Step 1: Generate Participant ID
                  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚    â”‚ idGenerator.js              â”‚
                  â”‚    â”‚                             â”‚
                  â”‚    â”‚ registrationType = 'both'   â”‚
                  â”‚    â”‚ â†’ Find last SHGN ID         â”‚
                  â”‚    â”‚ â†’ Get highest number        â”‚
                  â”‚    â”‚ â†’ Increment (001 â†’ 002)     â”‚
                  â”‚    â”‚ â†’ Return "SHGN002"          â”‚
                  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚    Result: participantId = "SHGN002"
                  â”‚
                  â†“
                  â”œâ”€â”€â†’ Step 2: Generate QR Code
                  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚    â”‚ qrGenerator.js              â”‚
                  â”‚    â”‚                             â”‚
                  â”‚    â”‚ Create QR data:             â”‚
                  â”‚    â”‚ {                           â”‚
                  â”‚    â”‚   participantId: "SHGN002"  â”‚
                  â”‚    â”‚   name: "John Doe"          â”‚
                  â”‚    â”‚   email: "john@mail.com"    â”‚
                  â”‚    â”‚   registrationType: "both"  â”‚
                  â”‚    â”‚   eventName: "SHACKLES"     â”‚
                  â”‚    â”‚ }                           â”‚
                  â”‚    â”‚                             â”‚
                  â”‚    â”‚ Generate PNG (500x500px)    â”‚
                  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚    Result: QR buffer created
                  â”‚
                  â†“
                  â”œâ”€â”€â†’ Step 3: Upload to S3
                  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚    â”‚ s3Upload.js                 â”‚
                  â”‚    â”‚                             â”‚
                  â”‚    â”‚ uploadBufferToS3()          â”‚
                  â”‚    â”‚                             â”‚
                  â”‚    â”‚ Bucket: shackles-25-26      â”‚
                  â”‚    â”‚ Folder: qrcodes/            â”‚
                  â”‚    â”‚ File: 1234567890-SHGN002.pngâ”‚
                  â”‚    â”‚                             â”‚
                  â”‚    â”‚ Set: ACL = public-read      â”‚
                  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚    Result: URL returned
                  â”‚    https://s3.amazonaws.com/...
                  â”‚
                  â†“
                  â”œâ”€â”€â†’ Step 4: Update Database
                  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚    â”‚ MongoDB Update              â”‚
                  â”‚    â”‚                             â”‚
                  â”‚    â”‚ user.participantId =        â”‚
                  â”‚    â”‚   "SHGN002"                 â”‚
                  â”‚    â”‚                             â”‚
                  â”‚    â”‚ user.qrCode =               â”‚
                  â”‚    â”‚   "https://s3..."           â”‚
                  â”‚    â”‚                             â”‚
                  â”‚    â”‚ user.qrCodeKey =            â”‚
                  â”‚    â”‚   "qrcodes/..."             â”‚
                  â”‚    â”‚                             â”‚
                  â”‚    â”‚ user.paymentStatus =        â”‚
                  â”‚    â”‚   "verified"                â”‚
                  â”‚    â”‚                             â”‚
                  â”‚    â”‚ user.verifiedAt = now()     â”‚
                  â”‚    â”‚ user.verifiedBy = adminId   â”‚
                  â”‚    â”‚                             â”‚
                  â”‚    â”‚ await user.save()           â”‚
                  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚    Result: User updated in DB
                  â”‚
                  â†“
                  â””â”€â”€â†’ Step 5: Send Email
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚ emailService.js             â”‚
                       â”‚                             â”‚
                       â”‚ sendEmail({                 â”‚
                       â”‚   to: "john@mail.com"       â”‚
                       â”‚   subject: "Payment Verifiedâ”‚
                       â”‚   html: <Beautiful Template>â”‚
                       â”‚ })                          â”‚
                       â”‚                             â”‚
                       â”‚ Email Contains:             â”‚
                       â”‚ âœ… Participant ID Display   â”‚
                       â”‚ âœ… QR Code (base64)         â”‚
                       â”‚ âœ… Registration Details     â”‚
                       â”‚ âœ… Event Information        â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       Result: Email sent


4ï¸âƒ£  USER RECEIVES EMAIL

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ğŸ“§ Email Inbox                                  â”‚
    â”‚                                                  â”‚
    â”‚  From: SHACKLES Team                            â”‚
    â”‚  Subject: âœ… Payment Verified - Your            â”‚
    â”‚           Participant ID: SHGN002               â”‚
    â”‚                                                  â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚ ğŸ‰ Payment Verified!                    â”‚   â”‚
    â”‚  â”‚                                         â”‚   â”‚
    â”‚  â”‚ Dear John Doe,                          â”‚   â”‚
    â”‚  â”‚                                         â”‚   â”‚
    â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
    â”‚  â”‚ â”‚  Your Participant ID            â”‚   â”‚   â”‚
    â”‚  â”‚ â”‚                                 â”‚   â”‚   â”‚
    â”‚  â”‚ â”‚       SHGN002                  â”‚   â”‚   â”‚
    â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
    â”‚  â”‚                                         â”‚   â”‚
    â”‚  â”‚ Registration Type: General + Workshop   â”‚   â”‚
    â”‚  â”‚ Amount Paid: â‚¹500                      â”‚   â”‚
    â”‚  â”‚                                         â”‚   â”‚
    â”‚  â”‚ [QR Code Image]                        â”‚   â”‚
    â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                      â”‚   â”‚
    â”‚  â”‚  â–ˆâ–ˆ  â–„â–„  â–ˆâ–ˆ  â–„â–„  â–ˆâ–ˆ                    â”‚   â”‚
    â”‚  â”‚  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ                    â”‚   â”‚
    â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                      â”‚   â”‚
    â”‚  â”‚                                         â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


5ï¸âƒ£  AWS S3 BUCKET

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ S3 Bucket: shackles-25-26               â”‚
    â”‚                                         â”‚
    â”‚ â”œâ”€ uploads/                             â”‚
    â”‚ â”‚   â””â”€ payment-screenshots/             â”‚
    â”‚ â”‚                                       â”‚
    â”‚ â””â”€ qrcodes/                             â”‚
    â”‚     â”œâ”€ 1234567890-SHGN001.png          â”‚
    â”‚     â”œâ”€ 1234567891-SHGN002.png  â† NEW!  â”‚
    â”‚     â”œâ”€ 1234567892-SHEN001.png          â”‚
    â”‚     â””â”€ 1234567893-SHWK001.png          â”‚
    â”‚                                         â”‚
    â”‚ Public URL:                             â”‚
    â”‚ https://shackles-25-26.s3.              â”‚
    â”‚ ap-south-1.amazonaws.com/               â”‚
    â”‚ qrcodes/1234567891-SHGN002.png          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


6ï¸âƒ£  MONGODB DATABASE

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Database: shackles_db                   â”‚
    â”‚ Collection: users                       â”‚
    â”‚                                         â”‚
    â”‚ {                                       â”‚
    â”‚   _id: ObjectId("..."),                 â”‚
    â”‚   name: "John Doe",                     â”‚
    â”‚   email: "john@mail.com",               â”‚
    â”‚   registrationType: "both",             â”‚
    â”‚   paymentAmount: 500,                   â”‚
    â”‚   transactionId: "TXN123456",           â”‚
    â”‚                                         â”‚
    â”‚   // VERIFICATION FIELDS:               â”‚
    â”‚   paymentStatus: "verified",            â”‚
    â”‚   verifiedAt: ISODate("2025-01-15"),    â”‚
    â”‚   verifiedBy: ObjectId("admin-id"),     â”‚
    â”‚   verificationNotes: "Payment confirmed"â”‚
    â”‚                                         â”‚
    â”‚   // NEW PARTICIPANT FIELDS:            â”‚
    â”‚   participantId: "SHGN002", â† NEW!      â”‚
    â”‚   qrCode: "https://s3...", â† NEW!       â”‚
    â”‚   qrCodeKey: "qrcodes/...", â† NEW!      â”‚
    â”‚                                         â”‚
    â”‚   createdAt: ISODate("..."),            â”‚
    â”‚   updatedAt: ISODate("...")             â”‚
    â”‚ }                                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


7ï¸âƒ£  ADMIN DASHBOARD RESPONSE

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Success Message:                        â”‚
    â”‚                                         â”‚
    â”‚ âœ… Payment verified successfully!       â”‚
    â”‚                                         â”‚
    â”‚ Participant Details:                    â”‚
    â”‚ â€¢ ID: SHGN002                          â”‚
    â”‚ â€¢ QR Code: [View]                      â”‚
    â”‚ â€¢ Email Sent: âœ“                        â”‚
    â”‚                                         â”‚
    â”‚ [Close]                                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


8ï¸âƒ£  USER CAN ACCESS ANYTIME

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ User Profile (GET /api/v1/users/me)     â”‚
    â”‚                                         â”‚
    â”‚ Name: John Doe                          â”‚
    â”‚ Email: john@mail.com                    â”‚
    â”‚                                         â”‚
    â”‚ Participant ID: SHGN002 â† Visible!     â”‚
    â”‚ Payment Status: âœ… Verified            â”‚
    â”‚                                         â”‚
    â”‚ QR Code: [View] [Download]             â”‚
    â”‚                                         â”‚
    â”‚ Registration Type: General + Workshop   â”‚
    â”‚ Amount Paid: â‚¹500                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” ID Generation Logic Deep Dive

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             generateParticipantId(registrationType)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

INPUT: registrationType = 'both'

STEP 1: Determine Prefix
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ switch (registrationType) {          â”‚
â”‚   case 'both':                       â”‚
â”‚     prefix = 'SHGN'                  â”‚
â”‚   case 'general':                    â”‚
â”‚     prefix = 'SHEN'                  â”‚
â”‚   case 'workshop':                   â”‚
â”‚     prefix = 'SHWK'                  â”‚
â”‚ }                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Result: prefix = 'SHGN'


STEP 2: Find Last User with Same Prefix
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MongoDB Query:                       â”‚
â”‚                                      â”‚
â”‚ User.findOne({                       â”‚
â”‚   participantId: {                   â”‚
â”‚     $regex: '^SHGN'                  â”‚
â”‚   }                                  â”‚
â”‚ })                                   â”‚
â”‚ .sort({ participantId: -1 })         â”‚
â”‚ .select('participantId')             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Result: lastUser.participantId = 'SHGN001'


STEP 3: Extract Number and Increment
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ lastNumber = parseInt(               â”‚
â”‚   'SHGN001'.replace('SHGN', ''),     â”‚
â”‚   10                                 â”‚
â”‚ )                                    â”‚
â”‚ // Result: 1                         â”‚
â”‚                                      â”‚
â”‚ nextNumber = lastNumber + 1          â”‚
â”‚ // Result: 2                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Result: nextNumber = 2


STEP 4: Format with Leading Zeros
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ paddedNumber = String(2)             â”‚
â”‚   .padStart(3, '0')                  â”‚
â”‚                                      â”‚
â”‚ // '2' â†’ '002'                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Result: paddedNumber = '002'


STEP 5: Combine Prefix + Number
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ participantId = prefix + paddedNumberâ”‚
â”‚               = 'SHGN' + '002'       â”‚
â”‚               = 'SHGN002'            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Result: participantId = 'SHGN002'


STEP 6: Check for Collisions
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ exists = await User.findOne({        â”‚
â”‚   participantId: 'SHGN002'           â”‚
â”‚ })                                   â”‚
â”‚                                      â”‚
â”‚ if (exists) {                        â”‚
â”‚   // Recursively try next number    â”‚
â”‚   return generateParticipantId(...)  â”‚
â”‚ }                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Result: No collision, proceed


OUTPUT: 'SHGN002'
```

---

## ğŸ“Š Counter Example

```
DATABASE STATE:

Existing Users:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Name           â”‚ Reg Type        â”‚ P-ID        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Alice          â”‚ both            â”‚ SHGN001     â”‚
â”‚ Bob            â”‚ general         â”‚ SHEN001     â”‚
â”‚ Carol          â”‚ workshop        â”‚ SHWK001     â”‚
â”‚ David          â”‚ both            â”‚ SHGN002     â”‚
â”‚ Eve            â”‚ general         â”‚ SHEN002     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

NEXT IDs:
â€¢ New 'both' user     â†’ SHGN003 (last was SHGN002)
â€¢ New 'general' user  â†’ SHEN003 (last was SHEN002)
â€¢ New 'workshop' user â†’ SHWK002 (last was SHWK001)

Each type has INDEPENDENT counter! âœ…
```

---

## ğŸ¯ Complete Feature List

âœ… Automatic ID generation on payment verification
âœ… Three ID types (SHGN, SHEN, SHWK)
âœ… Sequential numbering with leading zeros
âœ… Unique constraint prevents duplicates
âœ… QR code generation (500x500px PNG)
âœ… QR contains participant data (JSON)
âœ… Automatic S3 upload to qrcodes folder
âœ… Public URL returned for QR access
âœ… Beautiful HTML email with ID & QR
âœ… Database updated with all details
âœ… API endpoint to get participant by ID
âœ… API endpoint to regenerate QR code
âœ… Graceful error handling
âœ… Email fallback if issues occur
âœ… Mobile-responsive email design
âœ… Professional branding throughout

---

**System Status: OPERATIONAL âœ…**

Start verifying payments to see the system in action! ğŸš€
